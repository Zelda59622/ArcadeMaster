<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ArcadeMaster - Administration</title>
    <link rel="stylesheet" href="styles.css">
    
    <script>
        // --- Fonction du Menu Hamburger (CORRIG√âE: Utilise la largeur) ---
        function toggleMenu(x) {
            x.classList.toggle("change");
            const sidebar = document.getElementById("sidebar");
            
            if (sidebar.style.width === "250px") {
                sidebar.style.width = "0";
            } else {
                sidebar.style.width = "250px";
            }
        }
    </script>
</head>
<body>
    
    <div id="navbar">
        <div class="hamburger-menu" onclick="toggleMenu(this)">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
        <div id="auth-controls">
            </div>
    </div>

    <div id="sidebar">
        <a href="index.html">üè† Accueil</a>
        <a href="jeux.html">üïπÔ∏è Menu Jeux</a>
        <a href="credits.html">üìù Cr√©dits</a>
        <a href="classement.html">üèÜ Classement</a>
        </div>

    <div class="container">
        <h1>üõ°Ô∏è Panneau d'Administration</h1>
        <p style="text-align: center; color: #f39c12;">Cette page n'est visible que par les administrateurs.</p>

        <div class="admin-list-container">
            <h2>Gestion des Utilisateurs</h2>
            <div id="user-list">
                <p style="text-align: center;">Chargement des donn√©es...</p>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        const DEFAULT_PDP_URL = 'https://i.imgur.com/39hN7hG.png'; 

        function deleteUser(username) {
            if (confirm(`√ätes-vous s√ªr de vouloir supprimer l'utilisateur "${username}" ? Cette action est irr√©versible.`)) {
                
                // Suppression du compte
                const users = loadUsers(); 
                delete users[username];
                saveUsers(users);
                
                // Si l'utilisateur supprim√© √©tait l'administrateur courant, d√©connectez-le
                if (getCurrentUser() === username) {
                    logout();
                } else {
                    renderUserList(); // Rafra√Æchit la liste
                }
            }
        }

        function renderUserList() {
            if (typeof loadUsers === 'undefined' || typeof getCurrentUser === 'undefined' || typeof isAdmin === 'undefined') {
                document.getElementById('user-list').innerHTML = '<p style="color:red; text-align:center;">Erreur : auth.js n\'est pas charg√© correctement.</p>';
                return;
            }

            const currentUser = getCurrentUser();
            if (!currentUser || !isAdmin(currentUser)) {
                // Redirection si l'utilisateur n'est pas admin (s√©curit√© basique c√¥t√© client)
                window.location.href = 'index.html';
                return;
            }

            const users = loadUsers();
            const userListContainer = document.getElementById('user-list');
            userListContainer.innerHTML = ''; 

            for (const username in users) {
                const userData = users[username];
                const pdpUrl = userData.pdp || DEFAULT_PDP_URL;
                const isAdminUser = isAdmin(username);

                const div = document.createElement('div');
                div.classList.add('admin-list-item');
                div.innerHTML = `
                    <div class="user-details">
                        <img src="${pdpUrl}" alt="PDP" class="user-pdp-admin">
                        <span>${username}</span>
                        ${isAdminUser ? '<span class="admin-tag">(ADMIN)</span>' : ''}
                    </div>
                    ${username !== currentUser && !isAdminUser 
                        ? `<button class="delete-button" onclick="deleteUser('${username}')">Supprimer</button>` 
                        : (username === currentUser ? '<span style="color:#aaa;">(Vous)</span>' : '<span style="color:#f39c12;">(Admin)</span>')
                    }
                `;
                userListContainer.appendChild(div);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Assurez-vous que l'authentification est rendue en premier
            if (typeof renderAuthControls === 'function') {
                renderAuthControls();
            }
            // Ensuite, chargez la liste des utilisateurs si l'utilisateur est admin
            setTimeout(renderUserList, 200);
        });

        // Rendre la fonction de suppression accessible
        window.deleteUser = deleteUser;
    </script>
</body>
</html>
