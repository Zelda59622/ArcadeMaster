<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Master - Boutique</title>
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* Styles sp√©cifiques √† la boutique */
        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 40px;
            padding: 0 20px;
        }
        .item-card {
            background-color: var(--color-card-dark);
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
            text-align: center;
            padding: 20px;
            transition: transform 0.3s, border-color 0.3s;
            border: 3px solid transparent;
        }
        .item-card.owned {
            border-color: var(--color-neon-green);
        }
        .item-card.equipped {
            border-color: var(--color-neon-orange);
            box-shadow: 0 0 20px var(--color-neon-orange);
        }
        .item-card h3 {
            color: var(--color-neon-green);
            font-size: 2em;
            margin: 10px 0;
        }
        .item-card p {
            color: var(--color-text-light);
            margin-bottom: 15px;
        }
        .item-price {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--color-neon-orange);
            margin-bottom: 20px;
            display: block;
        }
        .item-card button {
            padding: 10px 20px;
            font-size: 1.1em;
            min-width: 150px;
        }
        .item-card button.buy-btn {
            background-color: var(--color-neon-orange);
        }
        .item-card button.equip-btn {
            background-color: var(--color-neon-green);
        }
        .shop-section h2 {
            margin-top: 50px;
            color: var(--color-neon-green);
            border-bottom: 2px solid var(--color-neon-orange);
            padding-bottom: 10px;
        }
    </style>
</head>
<body>

    <div id="top-bar">
        <div id="menuToggle" class="menu-toggle">
            <i class="fa-solid fa-bars"></i>
        </div>
        <span style="font-size: 1.5em; font-weight: bold; color: var(--color-neon-orange);">
            ARCADE SHOP
        </span>
        <div id="right-container" style="display: flex; align-items: center; gap: 15px;">
        </div>
    </div>

    <div id="sidebar" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" id="closeNav" onclick="closeNav()" style="position: absolute; top: 0; right: 25px; font-size: 36px; color: var(--color-neon-orange);">&times;</a>
        <div id="nav-links">
            <a href="index.html" data-emoji="üè†">üè† Accueil</a>
            <a href="jeux.html" data-emoji="üéÆ">üéÆ Menu Jeux</a>
            <a href="compte.html" data-emoji="üë§">üë§ Mon Compte</a>
            <a href="boutique.html" data-emoji="üõçÔ∏è">üõçÔ∏è Boutique</a>
            <a href="classement.html" data-emoji="üèÜ">üèÜ Classement</a>
            <a href="credits.html" data-emoji="üìú">üìú Cr√©dits</a>
        </div>
    </div>

    <div class="main-container" id="mainContent">
        <div style="padding-top: 50px;"></div> 
        
        <h1 style="font-size: 2.5em; color: var(--color-neon-orange);">BOUTIQUE DE COSM√âTIQUES</h1>
        
        <div id="shopContent" style="text-align: center;">
            <p style="color: var(--color-text-light); margin-top: 30px;">
                Vous devez √™tre **connect√©** pour acc√©der √† la boutique et acheter/√©quiper des skins.
            </p>
            <a href="compte.html" style="display: inline-block; margin-top: 20px; padding: 10px 30px; background-color: var(--color-neon-green); color: black; border-radius: 5px; text-decoration: none; font-weight: bold;">
                üîë Se connecter maintenant
            </a>
        </div>
        
    </div>
    
    <script src="base.js"></script>
    <script src="auth.js"></script>
    <script>
        // Logique sp√©cifique √† la boutique
        
        // Liste compl√®te des articles de la boutique
        const SHOP_ITEMS = [
            // --- Space Invaders Skins (Type: ship) ---
            { id: 0, name: "Vaisseau de base", emoji: 'üöÄ', price: 0, game: 'space_invaders', type: 'ship' },
            { id: 1, name: "Vaisseau √âclair", emoji: 'üõ∏', price: 500, game: 'space_invaders', type: 'ship' },
            { id: 2, name: "Vaisseau N√©on", emoji: 'üëΩ', price: 1200, game: 'space_invaders', type: 'ship' },
            { id: 3, name: "Vaisseau Royal", emoji: 'üëë', price: 5000, game: 'space_invaders', type: 'ship' },
            
            // --- Snake Infini Skins (Type: snake_head) ---
            { id: 4, name: "T√™te Serpent", emoji: 'üêç', price: 0, game: 'snake_infini', type: 'snake_head' },
            // ... (Ajouter d'autres skins pour Snake plus tard)
        ];
        
        /** G√©n√®re le HTML pour un item */
        function createItemCard(item, isOwned, isEquipped) {
            let statusText;
            let buttonHtml;
            let cardClass = '';

            if (isEquipped) {
                cardClass = 'equipped';
                statusText = '√âQUIP√â';
                buttonHtml = '<button class="equip-btn" disabled>√âQUIP√â</button>';
            } else if (isOwned) {
                cardClass = 'owned';
                statusText = 'Poss√©d√©';
                buttonHtml = `<button class="equip-btn" onclick="equipItem(${item.id})">√âquiper</button>`;
            } else {
                statusText = `${item.price} üí∞`;
                buttonHtml = `<button class="buy-btn" onclick="buyItem(${item.id})">Acheter</button>`;
            }

            return `
                <div class="item-card item-${item.id} ${cardClass}" data-game="${item.game}">
                    <h3>${item.name} ${item.emoji}</h3>
                    <p>Skin pour le jeu ${item.game.replace('_', ' ')}.</p>
                    <span class="item-price">${statusText}</span>
                    ${buttonHtml}
                </div>
            `;
        }

        /** Affiche la boutique ou le message de connexion */
        function renderShop() {
            const currentUser = getCurrentUser(); 
            const shopContent = document.getElementById('shopContent');
            
            if (!currentUser) {
                // Reste sur le message de connexion (d√©j√† dans le HTML)
                return;
            }
            
            // --- Utilisateur connect√© : Affichage de la boutique ---
            let shopHTML = `
                <p style="text-align: center; color: var(--color-text-light); margin-bottom: 30px;">
                    Votre solde actuel : <b style="color: var(--color-neon-orange);">${currentUser.coins} üí∞</b>
                </p>
                
                <div class="shop-section">
                    <h2>Space Invaders (Vaisseaux)</h2>
                    <div class="shop-grid">
                        ${SHOP_ITEMS.filter(i => i.game === 'space_invaders').map(item => {
                            const isOwned = currentUser.skins && currentUser.skins.owned && currentUser.skins.owned.includes(item.id);
                            const isEquipped = currentUser.skins && currentUser.skins.active && currentUser.skins.active.ship === item.emoji;
                            return createItemCard(item, isOwned || item.id === 0, isEquipped);
                        }).join('')}
                    </div>
                </div>

                <div class="shop-section">
                    <h2>Snake Infini (T√™tes)</h2>
                    <p style="color: gray;">üêç **COMMING SOON** - Les skins de Snake Infini seront bient√¥t disponibles √† l'achat !</p>
                    <div class="shop-grid">
                        ${SHOP_ITEMS.filter(i => i.game === 'snake_infini').map(item => {
                            // On peut montrer le skin de base, mais pas les autres.
                            const isOwned = currentUser.skins && currentUser.skins.owned && currentUser.skins.owned.includes(item.id);
                            const isEquipped = currentUser.skins && currentUser.skins.active && currentUser.skins.active.snake_head === item.emoji;
                            return createItemCard(item, isOwned || item.id === 4, isEquipped);
                        }).join('')}
                    </div>
                </div>

                <div class="shop-section">
                    <h2>Clicker Arcade</h2>
                    <p style="color: var(--color-neon-red);">‚ùå Pas de skins pr√©vus pour le Clicker Arcade.</p>
                </div>
            `;
            
            shopContent.innerHTML = shopHTML;
        }
        
        window.buyItem = function(itemId) {
            const currentUser = getCurrentUser();
            const item = SHOP_ITEMS.find(i => i.id === itemId);
            
            if (!currentUser || !item) return;

            if (currentUser.coins >= item.price) {
                // Achat r√©ussi
                currentUser.coins -= item.price;
                if (!currentUser.skins.owned) {
                    currentUser.skins.owned = [0, 4]; // Skins de base par d√©faut
                }
                if (!currentUser.skins.owned.includes(itemId)) {
                    currentUser.skins.owned.push(itemId);
                }
                
                updateGlobalUser(currentUser); 
                alert(`Achat r√©ussi : ${item.name} pour ${item.price} pi√®ces !`);
                renderShop(); // Rafra√Æchir l'affichage
            } else {
                alert(`Fonds insuffisants. Il vous manque ${item.price - currentUser.coins} pi√®ces.`);
            }
        }
        
        window.equipItem = function(itemId) {
            const currentUser = getCurrentUser();
            const item = SHOP_ITEMS.find(i => i.id === itemId);
            
            if (!currentUser || !item) return;

            // D√©termine la cl√© de skin √† mettre √† jour (ex: 'ship', 'snake_head')
            let skinKey;
            if (item.game === 'space_invaders' && item.type === 'ship') skinKey = 'ship';
            if (item.game === 'snake_infini' && item.type === 'snake_head') skinKey = 'snake_head';
            
            if (skinKey) {
                 // Assure que l'objet active existe
                if (!currentUser.skins.active) currentUser.skins.active = {};
                
                // √âquipement
                currentUser.skins.active[skinKey] = item.emoji;
                updateGlobalUser(currentUser);
                alert(`${item.name} √©quip√© pour ${item.game} !`);
                renderShop(); // Rafra√Æchir l'affichage
            }
        }

        document.addEventListener('DOMContentLoaded', renderShop);
    </script>
</body>
</html>
