<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Master - Boutique</title>
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <div id="top-bar">
        <div id="menuToggle" class="menu-toggle">
            <i class="fa-solid fa-bars"></i>
        </div>
        <span style="font-size: 1.5em; font-weight: bold; color: var(--color-neon-orange);">
            BOUTIQUE
        </span>
        <div style="display: flex; align-items: center; gap: 15px;">
            <a href="boutique.html" class="currency-display" title="Boutique">
                <span class="coin-count">0</span>
                <button id="trollButton" type="button">+</button>
            </a>
            <a href="compte.html" style="color: var(--color-text-light);" title="Mon Compte" data-emoji="ğŸ‘¤">
                ğŸ‘¤
            </a>
        </div>
    </div>

    <div id="sidebar" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" id="closeNav" onclick="closeNav()" style="position: absolute; top: 0; right: 25px; font-size: 36px; color: var(--color-neon-orange);">&times;</a>
        <div id="nav-links">
            <a href="index.html" data-emoji="ğŸ ">ğŸ  Accueil</a>
            <a href="jeux.html" data-emoji="ğŸ®">ğŸ® Menu Jeux</a>
            <a href="compte.html" data-emoji="ğŸ‘¤">ğŸ‘¤ Mon Compte</a>
            <a href="boutique.html" data-emoji="ğŸ›ï¸">ğŸ›ï¸ Boutique</a>
            <a href="classement.html" data-emoji="ğŸ†">ğŸ† Classement</a>
            <a href="credits.html" data-emoji="ğŸ“œ">ğŸ“œ CrÃ©dits</a>
        </div>
    </div>

    <div class="main-container" id="mainContent">
        <div style="padding-top: 50px;"></div> 
        
        <h1 style="font-size: 2.5em; color: var(--color-neon-orange); text-align: center;">BOUTIQUE ARCADE</h1>
        
        <div id="shopContent" style="text-align: center;">
            <p style="color: var(--color-text-light); margin-top: 30px;">
                Vous devez Ãªtre **connectÃ©** pour accÃ©der Ã  la boutique et acheter/Ã©quiper des skins.
            </p>
            <a href="compte.html" style="display: inline-block; margin-top: 20px; padding: 10px 30px; background-color: var(--color-neon-green); color: black; border-radius: 5px; text-decoration: none; font-weight: bold;">
                ğŸ”‘ Se connecter maintenant
            </a>
        </div>

        <div id="itemsContainer" class="shop-grid" style="display: none;">
            </div>
        
    </div>
    
    <script src="base.js"></script>
    <script src="auth.js"></script>
    <script>
        // Logique spÃ©cifique Ã  la boutique
        const SHOP_ITEMS = [
            { id: 0, name: "Vaisseau de base", emoji: 'ğŸš€', price: 0, game: 'space_invaders', type: 'ship' },
            { id: 1, name: "Vaisseau Ã‰clair", emoji: 'ğŸ›¸', price: 500, game: 'space_invaders', type: 'ship' },
            { id: 2, name: "Vaisseau NÃ©on", emoji: 'ğŸ‘½', price: 1200, game: 'space_invaders', type: 'ship' },
            { id: 3, name: "Vaisseau Royal", emoji: 'ğŸ‘‘', price: 5000, game: 'space_invaders', type: 'ship' },
            
            // Skins Snake Infini (Placeholders)
            { id: 4, name: "TÃªte Serpent", emoji: 'ğŸ', price: 0, game: 'snake_infini', type: 'snake_head' },
        ];
        
        function createItemCard(item, isOwned, isEquipped) {
            let statusText;
            let buttonHtml;
            let cardClass = '';

            if (isEquipped) {
                cardClass = 'equipped';
                statusText = 'Ã‰QUIPÃ‰';
                buttonHtml = '<button class="equip-btn" disabled>Ã‰QUIPÃ‰</button>';
            } else if (isOwned) {
                cardClass = 'owned';
                statusText = 'PossÃ©dÃ©';
                buttonHtml = `<button class="equip-btn" onclick="equipItem(${item.id})">Ã‰quiper</button>`;
            } else {
                statusText = `${item.price} ğŸ’°`;
                buttonHtml = `<button class="buy-btn" onclick="buyItem(${item.id})">Acheter</button>`;
            }

            return `
                <div class="item-card item-${item.id} ${cardClass}" data-game="${item.game}">
                    <h3>${item.name} ${item.emoji}</h3>
                    <p>Skin pour le jeu ${item.game.replace('_', ' ')}.</p>
                    <span class="item-price">${statusText}</span>
                    ${buttonHtml}
                </div>
            `;
        }

        function renderShop() {
            const currentUser = getCurrentUser(); 
            const shopContent = document.getElementById('shopContent');
            const itemsContainer = document.getElementById('itemsContainer');
            
            if (!currentUser) {
                shopContent.style.display = 'block';
                itemsContainer.style.display = 'none';
                return;
            }
            
            shopContent.style.display = 'none';
            itemsContainer.style.display = 'grid';

            let shopHTML = `
                <p style="text-align: center; color: var(--color-text-light); margin-bottom: 30px;">
                    Votre solde actuel : <b style="color: var(--color-neon-orange);">${currentUser.coins} ğŸ’°</b>
                </p>
                
                <div class="shop-section">
                    <h2>Space Invaders (Vaisseaux)</h2>
                    <div class="shop-grid">
                        ${SHOP_ITEMS.filter(i => i.game === 'space_invaders').map(item => {
                            const isOwned = currentUser.skins && currentUser.skins.owned && currentUser.skins.owned.includes(item.id);
                            const isEquipped = currentUser.skins && currentUser.skins.active && currentUser.skins.active.ship === item.emoji;
                            return createItemCard(item, isOwned || item.id === 0, isEquipped); 
                        }).join('')}
                    </div>
                </div>

                <div class="shop-section">
                    <h2>Snake Infini (TÃªtes)</h2>
                    <p style="color: gray;">ğŸ **COMMING SOON** - Les skins de Snake Infini seront bientÃ´t disponibles Ã  l'achat !</p>
                    <div class="shop-grid">
                        ${SHOP_ITEMS.filter(i => i.game === 'snake_infini').map(item => {
                            const isOwned = currentUser.skins && currentUser.skins.owned && currentUser.skins.owned.includes(item.id);
                            const isEquipped = currentUser.skins && currentUser.skins.active && currentUser.skins.active.snake_head === item.emoji;
                            return createItemCard(item, isOwned || item.id === 4, isEquipped);
                        }).join('')}
                    </div>
                </div>

                <div class="shop-section">
                    <h2>Clicker Arcade</h2>
                    <p style="color: var(--color-neon-red);">âŒ Pas de skins prÃ©vus pour le Clicker Arcade.</p>
                </div>
            `;
            
            itemsContainer.innerHTML = shopHTML;
        }

        window.buyItem = function(itemId) {
            const currentUser = getCurrentUser();
            const item = SHOP_ITEMS.find(i => i.id === itemId);
            
            if (!currentUser || !item) return;

            if (currentUser.coins >= item.price) {
                currentUser.coins -= item.price;
                if (!currentUser.skins.owned) currentUser.skins.owned = [0, 4];
                if (!currentUser.skins.owned.includes(itemId)) currentUser.skins.owned.push(itemId);
                
                updateGlobalUser(currentUser); 
                alert(`Achat rÃ©ussi : ${item.name} pour ${item.price} piÃ¨ces !`);
                renderShop();
                updateTopBar();
            } else {
                alert(`Fonds insuffisants. Il vous manque ${item.price - currentUser.coins} piÃ¨ces.`);
            }
        }
        
        window.equipItem = function(itemId) {
            const currentUser = getCurrentUser();
            const item = SHOP_ITEMS.find(i => i.id === itemId);
            
            if (!currentUser || !item) return;

            let skinKey;
            if (item.game === 'space_invaders' && item.type === 'ship') skinKey = 'ship';
            if (item.game === 'snake_infini' && item.type === 'snake_head') skinKey = 'snake_head';
            
            if (skinKey) {
                if (!currentUser.skins.active) currentUser.skins.active = {};
                currentUser.skins.active[skinKey] = item.emoji;
                updateGlobalUser(currentUser);
                alert(`${item.name} Ã©quipÃ© pour ${item.game} !`);
                renderShop();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
             renderShop();
             updateTopBar(); // Appel de la fonction de base pour synchroniser la barre
        });
    </script>
</body>
</html>
