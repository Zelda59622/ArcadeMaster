<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Master - Mon Compte</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Styles sp√©cifiques pour le formulaire de compte */
        .form-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            background-color: var(--color-background-medium);
            border-radius: 10px;
            border: 2px solid var(--color-neon-blue);
            box-shadow: 0 0 15px rgba(0, 229, 255, 0.4);
            text-align: center;
        }
        .form-container h2 {
            color: var(--color-neon-orange);
            margin-bottom: 20px;
        }
        .form-container input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--color-text-medium);
            border-radius: 5px;
            background-color: var(--color-background-dark);
            color: var(--color-text-light);
            box-sizing: border-box;
        }
        .form-container button {
            width: 100%;
            margin-top: 10px;
        }
        .status-message {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    
    <div id="top-bar"></div>
    <div id="sidebar" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <div id="nav-links"></div>
    </div>

    <div class="main-container" id="mainContent">
        
        <h1 style="color: var(--color-neon-blue); text-align: center;">GESTION DU COMPTE</h1>
        <hr>

        <div class="form-container" id="loggedInView" style="display: none;">
            <h2 style="color: var(--color-neon-green);"><i class="fas fa-user-check"></i> Connexion R√©ussie !</h2>
            <p style="color: var(--color-text-light);">Bienvenue, <strong id="usernameDisplay" style="color: var(--color-neon-orange);"></strong>.</p>
            <div style="margin-top: 20px; padding: 10px; border: 1px solid var(--color-neon-blue); border-radius: 5px;">
                <p style="color: var(--color-neon-blue);">Pi√®ces : <strong id="coinsDisplay" style="color: var(--color-neon-green);">0</strong> üí∞</p>
                <p style="color: var(--color-neon-blue);">Skin √âquip√© : <strong id="activeSkinDisplay" style="color: var(--color-neon-orange);">Standard</strong></p>
            </div>
            <button id="logoutButton" class="btn-primary" style="background-color: var(--color-neon-red); margin-top: 25px;">
                <i class="fas fa-sign-out-alt"></i> Se D√©connecter
            </button>
        </div>

        <div id="loggedOutView" style="display: none;">
            
            <div class="form-container" id="loginForm">
                <h2 style="color: var(--color-neon-orange);">CONNEXION</h2>
                <input type="text" id="loginUsername" placeholder="Nom d'utilisateur" required>
                <input type="password" id="loginPassword" placeholder="Mot de passe" required>
                <button id="loginButton" class="btn-primary" style="background-color: var(--color-neon-green);">
                    <i class="fas fa-sign-in-alt"></i> Se Connecter
                </button>
                <div class="status-message" id="loginStatus" style="color: var(--color-neon-red);"></div>
            </div>

            <div class="form-container" id="registerForm" style="margin-top: 20px;">
                <h2 style="color: var(--color-neon-blue);">INSCRIPTION</h2>
                <input type="text" id="registerUsername" placeholder="Choisir un nom d'utilisateur" required>
                <input type="password" id="registerPassword" placeholder="Choisir un mot de passe" required>
                <button id="registerButton" class="btn-primary" style="background-color: var(--color-neon-blue);">
                    <i class="fas fa-user-plus"></i> S'inscrire
                </button>
                <div class="status-message" id="registerStatus" style="color: var(--color-neon-red);"></div>
            </div>

        </div>

    </div>
    
    <script src="base.js"></script>
    <script src="auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loggedInView = document.getElementById('loggedInView');
            const loggedOutView = document.getElementById('loggedOutView');
            const logoutButton = document.getElementById('logoutButton');
            
            const loginButton = document.getElementById('loginButton');
            const registerButton = document.getElementById('registerButton');

            // --- Fonctions de mise √† jour ---
            function updateAccountView() {
                const user = getCurrentUser();

                if (user.id !== 0) {
                    // Afficher la vue Connect√©
                    loggedInView.style.display = 'block';
                    loggedOutView.style.display = 'none';
                    
                    document.getElementById('usernameDisplay').textContent = user.username;
                    document.getElementById('coinsDisplay').textContent = user.coins.toLocaleString('fr-FR');
                    document.getElementById('activeSkinDisplay').textContent = user.skins.active.vessel || 'Standard';

                } else {
                    // Afficher la vue D√©connect√©
                    loggedInView.style.display = 'none';
                    loggedOutView.style.display = 'block';
                }
            }
            
            // --- Gestion des √©v√©nements ---
            
            // CONNNEXION
            loginButton.addEventListener('click', () => {
                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;
                const status = document.getElementById('loginStatus');
                status.textContent = '';

                if (login(username, password)) {
                    status.style.color = 'var(--color-neon-green)';
                    status.textContent = 'Connexion r√©ussie ! Redirection...';
                    updateAccountView();
                    updateTopBar(); // Met √† jour le solde dans la barre sup√©rieure
                } else {
                    status.style.color = 'var(--color-neon-red)';
                    status.textContent = 'Erreur: Nom d\'utilisateur ou mot de passe incorrect.';
                }
            });
            
            // INSCRIPTION
            registerButton.addEventListener('click', () => {
                const username = document.getElementById('registerUsername').value;
                const password = document.getElementById('registerPassword').value;
                const status = document.getElementById('registerStatus');
                status.textContent = '';
                
                if (register(username, password)) {
                    status.style.color = 'var(--color-neon-green)';
                    status.textContent = 'Inscription r√©ussie ! Vous pouvez maintenant vous connecter.';
                    // Effacer les champs
                    document.getElementById('registerUsername').value = '';
                    document.getElementById('registerPassword').value = '';
                } else {
                    status.style.color = 'var(--color-neon-red)';
                    status.textContent = 'Erreur: Ce nom d\'utilisateur est d√©j√† pris.';
                }
            });

            // D√âCONNEXION
            logoutButton.addEventListener('click', () => {
                logout();
                updateAccountView();
                updateTopBar();
            });

            // Initialiser la vue au chargement
            updateAccountView();
        });
    </script>
</body>
</html>
