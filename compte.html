<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Master - Mon Compte</title>
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <div id="top-bar">
        <div id="menuToggle" class="menu-toggle">
            <i class="fa-solid fa-bars"></i>
        </div>
        
        <span style="font-size: 1.5em; font-weight: bold; color: var(--color-neon-green);">
            ARCADE MASTER
        </span>

        <div style="display: flex; align-items: center; gap: 15px;">
            <a href="boutique.html" class="currency-display" title="Boutique">
                <span class="coin-count">0</span>
                <button id="trollButton" type="button">+</button>
            </a>
            <a href="compte.html" style="color: var(--color-text-light);" title="Mon Compte" data-emoji="üë§">
                üë§
            </a>
        </div>
    </div>

    <div id="sidebar" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" id="closeNav" onclick="closeNav()" style="position: absolute; top: 0; right: 25px; font-size: 36px; color: var(--color-neon-orange);">&times;</a>
        <div id="nav-links">
            <a href="index.html" data-emoji="üè†">üè† Accueil</a>
            <a href="jeux.html" data-emoji="üéÆ">üéÆ Menu Jeux</a>
            <a href="compte.html" data-emoji="üë§">üë§ Mon Compte</a>
            <a href="boutique.html" data-emoji="üõçÔ∏è">üõçÔ∏è Boutique</a>
            <a href="classement.html" data-emoji="üèÜ">üèÜ Classement</a>
            <a href="credits.html" data-emoji="üìú">üìú Cr√©dits</a>
        </div>
    </div>

    <div class="main-container" id="mainContent">
        <div style="padding-top: 50px;"></div> 
        
        <h1 style="font-size: 2.5em;">GESTION DU COMPTE</h1>
        
        <div id="authContainer">
            <div class="auth-card" id="loginArea">
                <h2>Se Connecter</h2>
                <form id="loginForm">
                    <label for="loginUsername">Nom d'utilisateur</label>
                    <input type="text" id="loginUsername" name="username" required>
                    
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" name="password" required>
                    
                    <button type="submit">Connexion</button>
                </form>
                
                <p style="text-align: center; margin-top: 20px;">
                    Pas de compte ? <a href="#" id="showRegister" style="color: var(--color-neon-green);">S'inscrire ici.</a>
                </p>
            </div>
            
            <div class="auth-card" id="registerArea" style="display: none; margin-top: 20px;">
                <h2>S'inscrire</h2>
                <form id="registerForm">
                    <label for="registerUsername">Nom d'utilisateur</label>
                    <input type="text" id="registerUsername" name="username" required>
                    
                    <label for="registerPassword">Mot de passe</label>
                    <input type="password" id="registerPassword" name="password" required>
                    
                    <button type="submit">Inscription</button>
                </form>
                
                <p style="text-align: center; margin-top: 20px;">
                    D√©j√† un compte ? <a href="#" id="showLogin" style="color: var(--color-neon-green);">Se connecter.</a>
                </p>
            </div>
            
        </div>
    </div>
    
    <script src="base.js"></script>
    <script src="auth.js"></script>
    <script>
        // Scripts sp√©cifiques √† la page compte
        
        const authContainer = document.getElementById('authContainer');

        /**
         * Affiche la vue de gestion du profil si l'utilisateur est connect√©.
         * Sinon, laisse les formulaires d'auth.
         */
        function renderProfileView() {
            const currentUser = getCurrentUser(); // Fonction de auth.js
            
            if (currentUser) {
                authContainer.innerHTML = `
                    <div class="auth-card" style="max-width: 500px; text-align: center;">
                        <h2>Bienvenue, ${currentUser.username}!</h2>
                        
                        <div style="margin: 20px 0;">
                            <img id="profilePic" src="${currentUser.profilePic || 'default.png'}" 
                                 alt="Photo de profil" style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--color-neon-orange);">
                            
                            <p style="color: var(--color-text-light); margin-top: 10px;">
                                R√¥le: <span style="color: ${currentUser.role === 'admin' ? '#FFD700' : 'var(--color-neon-green)'}; font-weight: bold;">${currentUser.role.toUpperCase()}</span>
                            </p>
                            <p class="currency-display" style="justify-content: center; font-size: 1.5em; margin-top: 10px;">
                                <span class="coin-count">${currentUser.coins}</span> Pi√®ces
                            </p>
                        </div>
                        
                        <form id="changePasswordForm">
                            <h3 style="color: var(--color-neon-green); border-bottom: none; margin-top: 30px;">Changer le mot de passe</h3>
                            <label for="newPassword">Nouveau mot de passe</label>
                            <input type="password" id="newPassword" required>
                            <button type="submit" style="background-color: var(--color-neon-orange);">Mettre √† jour le mot de passe</button>
                        </form>
                        
                        <button id="logoutButton" style="background-color: var(--color-neon-red); margin-top: 30px;">
                            D√©connexion
                        </button>
                        
                        <p style="margin-top: 20px;"><a href="boutique.html" style="color: var(--color-neon-green);">üõçÔ∏è Acc√©der √† la boutique de cosm√©tiques</a></p>
                    </div>
                `;

                // Attache l'√©couteur de d√©connexion
                document.getElementById('logoutButton').addEventListener('click', logout);
                
                // Attache l'√©couteur de changement de mot de passe
                document.getElementById('changePasswordForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const newPassword = document.getElementById('newPassword').value;
                    if (newPassword.length < 4) {
                        alert("Le mot de passe doit contenir au moins 4 caract√®res.");
                        return;
                    }
                    
                    currentUser.password = newPassword;
                    updateGlobalUser(currentUser); // Fonction de auth.js
                    alert("Mot de passe mis √† jour avec succ√®s !");
                    document.getElementById('newPassword').value = '';
                });

                // (Optionnel: Ajouter ici la logique de changement de photo de profil si elle devient fonctionnelle)
                
            } else {
                // Utilisateur d√©connect√© : G√®re les soumissions de formulaires
                
                // 1. Soumission de Connexion
                document.getElementById('loginForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const username = document.getElementById('loginUsername').value;
                    const password = document.getElementById('loginPassword').value;
                    login(username, password); // Fonction de auth.js
                });

                // 2. Soumission d'Inscription
                document.getElementById('registerForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const username = document.getElementById('registerUsername').value;
                    const password = document.getElementById('registerPassword').value;
                    register(username, password); // Fonction de auth.js
                });

                // 3. Basculement Connexion/Inscription
                document.getElementById('showRegister').addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById('loginArea').style.display = 'none';
                    document.getElementById('registerArea').style.display = 'block';
                });

                document.getElementById('showLogin').addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById('registerArea').style.display = 'none';
                    document.getElementById('loginArea').style.display = 'block';
                });
            }
        }

        // Ex√©cute la vue appropri√©e au chargement apr√®s un l√©ger d√©lai pour s'assurer que auth.js est charg√©
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(renderProfileView, 10); 
        });

    </script>
</body>
</html>
