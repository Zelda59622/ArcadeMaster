<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Master - Mon Compte</title>
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <div id="top-bar">
        <div id="menuToggle" class="menu-toggle">
            <i class="fa-solid fa-bars"></i>
        </div>
        <span style="font-size: 1.5em; font-weight: bold; color: var(--color-neon-orange);">
            MON COMPTE
        </span>
        <div id="right-container" style="display: flex; align-items: center; gap: 15px;">
        </div>
    </div>

    <div id="sidebar" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" id="closeNav" onclick="closeNav()" style="position: absolute; top: 0; right: 25px; font-size: 36px; color: var(--color-neon-orange);">&times;</a>
        <div id="nav-links">
            <a href="index.html" data-emoji="üè†">üè† Accueil</a>
            <a href="jeux.html" data-emoji="üéÆ">üéÆ Menu Jeux</a>
            <a href="compte.html" data-emoji="üë§">üë§ Mon Compte</a>
            <a href="boutique.html" data-emoji="üõçÔ∏è">üõçÔ∏è Boutique</a>
            <a href="classement.html" data-emoji="üèÜ">üèÜ Classement</a>
            <a href="credits.html" data-emoji="üìú">üìú Cr√©dits</a>
        </div>
    </div>

    <div class="main-container" id="mainContent">
        <div style="padding-top: 50px;"></div> 
        
        <h1 style="font-size: 2em; color: var(--color-neon-orange);">GESTION DU COMPTE</h1>
        
        <div id="authContainer" class="auth-card-wrapper" style="max-width: 600px; margin: 30px auto;">
            
            <div id="loginArea" class="auth-card">
                <h2>üîë Connexion</h2>
                <form id="loginForm">
                    <label for="loginUsername">Nom d'utilisateur</label>
                    <input type="text" id="loginUsername" required>
                    
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" required>
                    
                    <button type="submit">Se connecter</button>
                </form>
                <p style="margin-top: 15px;">Pas encore de compte ? 
                    <a href="#" id="showRegister" style="color: var(--color-neon-green); text-decoration: underline;">S'inscrire ici</a>
                </p>
            </div>
            
            <div id="registerArea" class="auth-card" style="display: none;">
                <h2>üìù Inscription</h2>
                <form id="registerForm">
                    <label for="registerUsername">Nom d'utilisateur (3+ caract√®res)</label>
                    <input type="text" id="registerUsername" required>
                    
                    <label for="registerPassword">Mot de passe (4+ caract√®res)</label>
                    <input type="password" id="registerPassword" required>
                    
                    <button type="submit" style="background-color: var(--color-neon-green);">S'inscrire</button>
                </form>
                <p style="margin-top: 15px;">D√©j√† un compte ? 
                    <a href="#" id="showLogin" style="color: var(--color-neon-orange); text-decoration: underline;">Se connecter</a>
                </p>
            </div>
            
        </div>
        
    </div>
    
    <script src="base.js"></script>
    <script src="auth.js"></script>
    <script>
        // Scripts sp√©cifiques √† la page compte
        
        const authContainer = document.getElementById('authContainer');

        /**
         * Affiche la vue de gestion du profil si l'utilisateur est connect√©.
         * Sinon, laisse les formulaires d'auth et attache les √©couteurs.
         */
        window.renderProfileView = function() {
            const currentUser = getCurrentUser(); // Fonction de auth.js
            
            if (currentUser) {
                // --- VUE CONNECT√âE ---
                authContainer.innerHTML = `
                    <div class="auth-card" style="max-width: 500px; text-align: center;">
                        <h2>Bienvenue, ${currentUser.username}!</h2>
                        
                        <div style="margin: 20px 0;">
                            <img id="profilePic" src="${currentUser.profilePic || 'default.png'}" 
                                 alt="Photo de profil" style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--color-neon-orange);">
                            
                            <p style="color: var(--color-text-light); margin-top: 10px;">
                                R√¥le: <span style="color: ${currentUser.role === 'admin' ? '#FFD700' : 'var(--color-neon-green)'}; font-weight: bold;">${currentUser.role.toUpperCase()}</span>
                            </p>
                            <p class="currency-display" style="justify-content: center; font-size: 1.5em; margin-top: 10px;">
                                <span class="coin-count">${currentUser.coins}</span> Pi√®ces
                            </p>
                        </div>
                        
                        <form id="changePasswordForm">
                            <h3 style="color: var(--color-neon-green); border-bottom: none; margin-top: 30px;">Changer le mot de passe</h3>
                            <label for="newPassword">Nouveau mot de passe</label>
                            <input type="password" id="newPassword" required>
                            <button type="submit" style="background-color: var(--color-neon-orange);">Mettre √† jour le mot de passe</button>
                        </form>
                        
                        <button id="logoutButton" style="background-color: var(--color-neon-red); margin-top: 30px;">
                            D√©connexion
                        </button>
                        
                        <p style="margin-top: 20px;"><a href="boutique.html" style="color: var(--color-neon-green);">üõçÔ∏è Acc√©der √† la boutique de cosm√©tiques</a></p>
                    </div>
                `;

                // Attache l'√©couteur de d√©connexion
                document.getElementById('logoutButton').addEventListener('click', logout);
                
                // Attache l'√©couteur de changement de mot de passe
                document.getElementById('changePasswordForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const newPassword = document.getElementById('newPassword').value;
                    if (newPassword.length < 4) {
                        alert("Le mot de passe doit contenir au moins 4 caract√®res.");
                        return;
                    }
                    
                    currentUser.password = newPassword;
                    updateGlobalUser(currentUser); // Fonction de auth.js
                    alert("Mot de passe mis √† jour avec succ√®s !");
                    document.getElementById('newPassword').value = '';
                });

                
            } else {
                // --- VUE D√âCONNECT√âE : G√®re les soumissions de formulaires ---
                
                // 1. Soumission de Connexion
                const loginForm = document.getElementById('loginForm');
                if (loginForm) {
                    loginForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const username = document.getElementById('loginUsername').value;
                        const password = document.getElementById('loginPassword').value;
                        login(username, password); // Fonction de auth.js
                    });
                }

                // 2. Soumission d'Inscription
                const registerForm = document.getElementById('registerForm');
                if (registerForm) {
                    registerForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const username = document.getElementById('registerUsername').value;
                        const password = document.getElementById('registerPassword').value;
                        register(username, password); // Fonction de auth.js
                    });
                }

                // 3. Basculement Connexion/Inscription
                const showRegister = document.getElementById('showRegister');
                const showLogin = document.getElementById('showLogin');
                const loginArea = document.getElementById('loginArea');
                const registerArea = document.getElementById('registerArea');

                if (showRegister) {
                    showRegister.addEventListener('click', (e) => {
                        e.preventDefault();
                        if (loginArea && registerArea) {
                            loginArea.style.display = 'none';
                            registerArea.style.display = 'block';
                        }
                    });
                }

                if (showLogin) {
                    showLogin.addEventListener('click', (e) => {
                        e.preventDefault();
                        if (loginArea && registerArea) {
                            registerArea.style.display = 'none';
                            loginArea.style.display = 'block';
                        }
                    });
                }
            }
        }

        // Ex√©cute la vue appropri√©e au chargement (doit √™tre fait apr√®s que le DOM est pr√™t)
        document.addEventListener('DOMContentLoaded', () => {
             // Utilisation d'un court d√©lai pour garantir que base.js et auth.js ont fini d'ex√©cuter
             setTimeout(renderProfileView, 50); 
        });

    </script>
</body>
</html>
