<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ArcadeMaster - Compte</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    
    <div id="navbar">
        <div class="hamburger-menu" onclick="toggleMenu(this)">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
        <div id="auth-controls">
            </div>
    </div>

    <div id="sidebar">
        <a href="index.html">üè† Accueil</a>
        <a href="jeux.html">üïπÔ∏è Menu Jeux</a>
        <a href="credits.html">üìù Cr√©dits</a>
        <a href="classement.html">üèÜ Classement</a>
        </div>

    <div class="auth-container">
        <div id="auth-content">
            </div>
    </div>
    
    <script src="auth.js"></script>
    <script>
        // --- Logique du Menu Hamburger ---
        function toggleMenu(x) {
            x.classList.toggle("change");
            const sidebar = document.getElementById("sidebar");
            if (sidebar.style.width === "250px") {
                sidebar.style.width = "0";
            } else {
                sidebar.style.width = "250px";
            }
        }
        
        // --- Logique de la page d'authentification ---
        
        const authContent = document.getElementById('auth-content');

        function renderAccountPage() {
            const currentUser = getCurrentUser();
            
            if (currentUser) {
                // √âcran de gestion du compte (Connect√©)
                authContent.innerHTML = `
                    <h1>Espace Compte</h1>
                    <p>Connect√© en tant que: <strong style="color: #00ff00;">${currentUser}</strong></p>
                    <div id="account-form" class="auth-form">
                        <h2>Changer le Mot de Passe</h2>
                        <input type="password" id="current-password" placeholder="Mot de passe actuel" required>
                        <input type="password" id="new-password" placeholder="Nouveau mot de passe" required>
                        <button onclick="handleChangePassword()">Changer le Mot de Passe</button>
                        <button style="background-color: #e74c3c;" onclick="logout()">D√©connexion</button>
                    </div>
                `;
                
            } else {
                // √âcran de Connexion/Inscription (D√©connect√©)
                renderAuthForm(true); // Afficher la connexion par d√©faut
            }
        }

        function renderAuthForm(isLogin) {
            authContent.innerHTML = `
                <h1>${isLogin ? 'Connexion' : 'Inscription'}</h1>
                <form class="auth-form" onsubmit="event.preventDefault(); ${isLogin ? 'handleLogin(event)' : 'handleRegister(event)'};">
                    <input type="text" id="username" placeholder="Pseudo" required>
                    <input type="password" id="password" placeholder="Mot de passe" required>
                    ${isLogin ? '' : '<input type="password" id="confirm-password" placeholder="Confirmer le mot de passe" required>'}
                    <button type="submit">${isLogin ? 'Se Connecter' : 'S\'inscrire'}</button>
                </form>
                <p class="message" onclick="renderAuthForm(${!isLogin})">
                    ${isLogin ? 'Pas encore de compte ? S\'inscrire' : 'D√©j√† un compte ? Se connecter'}
                </p>
            `;
        }
        
        function handleRegister(event) {
            const username = event.target.elements['username'].value.trim();
            const password = event.target.elements['password'].value;
            const confirmPassword = event.target.elements['confirm-password'].value;
            
            if (!username || !password || !confirmPassword) return alert("Veuillez remplir tous les champs.");
            if (password !== confirmPassword) return alert("Les mots de passe ne correspondent pas.");
            
            const users = loadUsers();
            if (users[username]) return alert("Ce pseudo existe d√©j√†. Veuillez vous connecter.");
            
            users[username] = { password: password, games: {} };
            saveUsers(users);
            
            login(username);
            alert(`Compte "${username}" cr√©√© et connect√© !`);
            renderAccountPage(); 
        }

        function handleLogin(event) {
            const username = event.target.elements['username'].value.trim();
            const password = event.target.elements['password'].value;

            if (!username || !password) return alert("Veuillez remplir tous les champs.");

            const users = loadUsers();
            const user = users[username];

            if (!user || user.password !== password) {
                return alert("Pseudo ou mot de passe incorrect.");
            }

            login(username);
            alert(`Bienvenue, ${username} !`);
            window.location.href = 'index.html'; // Rediriger vers l'accueil apr√®s connexion
        }
        
        function handleChangePassword() {
            const currentUser = getCurrentUser();
            if (!currentUser) return;

            const currentPass = document.getElementById('current-password').value;
            const newPass = document.getElementById('new-password').value;

            if (!currentPass || !newPass) return alert("Veuillez remplir tous les champs.");
            if (currentPass === newPass) return alert("Le nouveau mot de passe doit √™tre diff√©rent de l'ancien.");

            const users = loadUsers();
            const user = users[currentUser];

            if (user.password !== currentPass) {
                return alert("Mot de passe actuel incorrect.");
            }

            if (changePassword(currentUser, newPass)) {
                alert("Mot de passe mis √† jour avec succ√®s !");
                document.getElementById('current-password').value = '';
                document.getElementById('new-password').value = '';
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
             // S'assurer que auth.js est charg√© avant de lancer la page de compte
            if (typeof getCurrentUser !== 'undefined') {
                renderAccountPage();
            } else {
                setTimeout(renderAccountPage, 100); 
            }
        });
        
        // Rendre les fonctions d'auth accessibles globalement pour le formulaire
        window.handleRegister = handleRegister;
        window.handleLogin = handleLogin;
        window.handleChangePassword = handleChangePassword;
        window.renderAuthForm = renderAuthForm;

    </script>
</body>
</html>
