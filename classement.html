<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ArcadeMaster - Classement</title>
    <link rel="stylesheet" href="styles.css">
    
    <script>
        // --- Correction Menu Hamburger (D√©finie t√¥t pour garantir l'accessibilit√©) ---
        function toggleMenu(x) {
            x.classList.toggle("change");
            const sidebar = document.getElementById("sidebar");
            if (sidebar.style.width === "250px") {
                sidebar.style.width = "0";
            } else {
                sidebar.style.width = "250px";
            }
        }
    </script>

    <style>
        /* Styles sp√©cifiques pour le classement */
        
        .leaderboard-table th:nth-child(4), 
        .leaderboard-table td:nth-child(4) { 
            text-align: right; 
            font-weight: bold; 
        }
        
        .leaderboard-table th:nth-child(1),
        .leaderboard-table td:nth-child(1) {
             text-align: center;
             width: 50px;
        }

    </style>
</head>
<body>
    
    <div id="navbar">
        <div class="hamburger-menu" onclick="toggleMenu(this)">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
        <div id="auth-controls">
            </div>
    </div>

    <div id="sidebar">
        <a href="index.html">üè† Accueil</a>
        <a href="jeux.html">üïπÔ∏è Menu Jeux</a>
        <a href="credits.html">üìù Cr√©dits</a>
        <a href="authentification.html">‚öôÔ∏è Compte</a>
        </div>

    <div class="container">
        <h1>üèÜ Classements</h1>
        
        <div id="personal-rank-container" style="margin-bottom: 30px; text-align: center; padding: 15px; background: #3a3a3a; border-radius: 8px; display:none;">
            </div>

        <div class="leaderboard-grid">
            
            <div class="leaderboard-box">
                <h2>Space Invaders (Top 10)</h2>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rng</th>
                            <th>Joueur</th>
                            <th>PDP</th> 
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardTable_space_invaders">
                        <tr><td colspan="4" style="text-align:center;">Chargement en cours...</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="leaderboard-box">
                <h2>Jeu Exemple (Top 10)</h2>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rng</th>
                            <th>Joueur</th>
                            <th>PDP</th> 
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardTable_jeu_exemple">
                         <tr><td colspan="4" style="text-align:center;">Classement non disponible.</td></tr>
                    </tbody>
                </table>
            </div>
            
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        const DEFAULT_PDP_URL = 'https://i.imgur.com/39hN7hG.png'; 

        // Fonction g√©n√©rique pour rendre n'importe quel classement Top X
        function renderTopLeaderboard(gameId) {
            const leaderboardBody = document.getElementById(`leaderboardTable_${gameId}`);
            if (!leaderboardBody) return;

            // V√âRIFICATION DE S√âCURIT√â : Assurez-vous que les fonctions d'AUTH sont l√†
            if (typeof getLeaderboard === 'undefined' || typeof getUserData === 'undefined') {
                leaderboardBody.innerHTML = '<tr><td colspan="4">Erreur: Script d\'authentification (auth.js) manquant ou fonctions non disponibles.</td></tr>';
                return;
            }

            const leaderboardData = getLeaderboard(gameId, 10); // Top 10
            leaderboardBody.innerHTML = ''; 

            if (leaderboardData.length === 0) {
                 leaderboardBody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Aucun score enregistr√©.</td></tr>';
                 return;
            }

            leaderboardData.forEach((entry, index) => {
                const rank = index + 1;
                let trophy = '';
                
                const userData = getUserData(entry.username);
                const pdpUrl = userData && userData.pdp ? userData.pdp : DEFAULT_PDP_URL;

                if (rank === 1) {
                    trophy = '<span class="trophy">ü•á</span>';
                } else if (rank === 2) {
                    trophy = '<span class="trophy">ü•à</span>';
                } else if (rank === 3) {
                    trophy = '<span class="trophy">ü•â</span>';
                }

                const row = leaderboardBody.insertRow();
                
                // Rng, Joueur, PDP, Score
                row.insertCell().innerHTML = `${trophy} ${rank}`;
                row.insertCell().textContent = entry.username;
                row.insertCell().innerHTML = `<div class="user-display"><img src="${pdpUrl}" alt="PDP" class="leaderboard-pdp"></div>`;
                row.insertCell().textContent = entry.score;
            });
        }
        
        // Fonction pour afficher le classement personnel du joueur
        function renderPersonalRank(gameId) {
            
            if (typeof getCurrentUser === 'undefined' || typeof getPersonalRank === 'undefined') {
                 // Si les fonctions sont manquantes, on ne fait rien
                 document.getElementById('personal-rank-container').style.display = 'none';
                 return;
            }
            
            const currentUser = getCurrentUser();
            const container = document.getElementById('personal-rank-container');
            
            if (!currentUser) {
                container.style.display = 'none';
                return;
            }

            const rankData = getPersonalRank(currentUser, gameId);

            if (rankData && rankData.rank <= 10) {
                container.style.display = 'none';
            } else if (rankData) {
                container.style.display = 'block';
                container.innerHTML = `
                    <h3>Votre Classement Personnel (Space Invaders)</h3>
                    <p style="font-size: 1.2em;">
                        Vous √™tes actuellement au rang 
                        <strong style="color: #00ff00;">#${rankData.rank}</strong> 
                        avec un score de <strong>${rankData.score}</strong>.
                    </p>
                `;
            } else {
                container.style.display = 'block';
                container.innerHTML = `
                    <h3>Votre Classement Personnel (Space Invaders)</h3>
                    <p>Vous n'avez pas encore enregistr√© de score pour ce jeu. Jouez pour appara√Ætre dans le classement !</p>
                `;
            }
        }

        function initializeLeaderboard() {
            // S'assurer que la navbar est rendue (Admin Link/PDP)
            if (typeof renderAuthControls === 'function') {
                renderAuthControls();
            }
            
            // Rendu des classements
            renderTopLeaderboard('space_invaders');
            renderPersonalRank('space_invaders');
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Utiliser un d√©lai pour s'assurer que auth.js a fini d'√™tre charg√© et ex√©cut√©
            setTimeout(initializeLeaderboard, 150); 
        });
    </script>
</body>
</html>
